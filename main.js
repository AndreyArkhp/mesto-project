(()=>{"use strict";var e={d:(t,r)=>{for(var n in r)e.o(r,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:r[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{dS:()=>Y,IJ:()=>W,Ac:()=>X});var t=document.querySelector(".popup_type_open-img"),r=t.querySelector(".popup__title"),n=t.querySelector(".popup__image"),o="popup_opened";function c(e){e.classList.add(o),document.addEventListener("keydown",i)}function a(e){e.classList.remove(o),document.removeEventListener("keydown",i)}function i(e){Object.is(e.key,"Escape")&&a(document.querySelector(".".concat(o)))}var u=["inputSelector","errorClass","inputErrorClass"];function s(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},c=Object.keys(e);for(n=0;n<c.length;n++)r=c[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(n=0;n<c.length;n++)r=c[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}function l(e,t){e.classList.add(t),e.setAttribute("disabled","disabled")}var d={baseUrl:"https://nomoreparties.co/v1/plus-cohort-6/",headers:{authorization:"65d32b7f-c1f2-44b3-9a5c-d1cd8d3f9a2c","Content-Type":"application/json"},ownerId:"a40dc32b197666cc70ed64f0"};function f(e){if(e.ok)return e.json();throw new Error(e.status)}function p(){return fetch("".concat(d.baseUrl,"users/me"),{headers:d.headers}).then(f)}var m,_=document.querySelector(".form_type_new-place"),y=_.querySelector(".form__button"),v=document.querySelector(".cards__list"),h=_.querySelector(".form__item_type_place"),b=_.querySelector(".form__item_type_url"),S=document.querySelector(".popup_type_new-place"),E=document.querySelector(".popup_for_delete-card"),q=E.querySelector(".form__button"),g="card__like_active";function C(e,t){e.textContent=t.likes.length}function L(e,t,r){r?e.append(t):e.prepend(t)}function x(e){var o=document.querySelector(".template-card").content.querySelector(".card-element").cloneNode(!0),i=o.querySelector(".card__image"),u=o.querySelector(".card__title"),s=o.querySelector(".card__like"),l=o.querySelector(".card__trash-icon"),p=o.querySelector(".card__like-counter");return i.src=e.link,i.alt=e.name,u.textContent=e.name,Object.is(e.owner._id,d.ownerId)&&l.classList.add("card__trash-icon_visible"),e.likes.some((function(e){return Object.is(e._id,d.ownerId)}))&&s.classList.add(g),C(p,e),i.addEventListener("click",(function(){return function(e){r.textContent=e.name,n.alt="Изображение ".concat(e.name),n.src=e.link,c(t)}(e)})),s.addEventListener("click",(function(t){return function(e,t,r){var n;e.target.classList.toggle(g),e.target.classList.contains(g)?(n=t._id,fetch("".concat(d.baseUrl,"cards/likes/").concat(n),{method:"PUT",headers:d.headers}).then(f)).then((function(e){C(r,e)})).catch((function(e){c(popupError),Y(e.message,errorTitle,errorText),console.log("Error: ".concat(e))})):function(e){return fetch("".concat(d.baseUrl,"cards/likes/").concat(e),{method:"DELETE",headers:d.headers}).then(f)}(t._id).then((function(e){C(r,e)})).catch((function(e){c(popupError),Y(e.message,errorTitle,errorText),console.log("Error: ".concat(e))}))}(t,e,p)})),l.addEventListener("click",(function(t){c(E),q.addEventListener("click",m=function(){!function(e,t){var r;e.target.closest(".card-element").remove(),(r=t,fetch("".concat(d.baseUrl,"cards/").concat(r),{method:"DELETE",headers:d.headers})).catch((function(e){c(popupError),Y(e.message,errorTitle,errorText),console.log("Error: ".concat(e))})),a(E),q.removeEventListener("click",m)}(t,e._id)})})),o}var k,O,T,w=document.querySelector(".profile__name"),j=document.querySelector(".profile__mission"),U=document.querySelector(".profile__avatar-container"),A=U.querySelector(".profile__avatar"),P=document.querySelector(".profile__add-button"),B=document.querySelector(".profile__edit-button"),D=document.querySelector(".popup_type_edit-profile"),I=document.querySelector(".popup_type_edit-avatar"),J=document.querySelector(".form_type_edit-profile"),N=J.querySelector(".form__button"),H=document.querySelector(".form_type_edit-avatar"),z=H.querySelector(".form__item_type_url-avatar"),M=H.querySelector(".form__button"),R=document.querySelector(".form__item_type_name"),F=document.querySelector(".form__item_type_mission"),G=document.querySelectorAll(".popup"),K=document.querySelector(".popup_for_error"),Q=K.querySelector(".popup__title_for_error"),V=K.querySelector(".popup__text-error"),W=100,X={formSelector:".form",errorClass:"form__error-message_visible",inputSelector:".form__item",inputErrorClass:"form__item_invalid",submitButtonSelector:".form__button",inactiveButtonClass:"form__button_disabled"};function Y(e,t,r){switch(e){case"400":t.textContent="Проверьте введенный адресс",r.textContent="Код ошибки 400";break;case"403":t.textContent="Доступ запрещен",r.textContent="Код ошибки 403";break;case"404":t.textContent="Ресурс не найден",r.textContent="Код ошибки: 404. Проверьте URL ";break;case"500":t.textContent="Ошибка сервера",r.textContent="Попробуйте повторить позже";break;default:t.textContent="Ошибка",r.textContent="Код ошибки ".concat(e)}}B.addEventListener("click",(function(){p().then((function(e){R.value=e.name,F.value=e.about})).catch((function(e){c(K),Y(e.message,Q,V),console.log("Error: ".concat(e))})),c(D)})),P.addEventListener("click",(function(){return c(S)})),J.addEventListener("submit",(function(e){e.preventDefault(),N.textContent="Сохранение...",function(e,t){return fetch("".concat(d.baseUrl,"users/me"),{method:"PATCH",headers:d.headers,body:JSON.stringify({name:e.value,about:t.value})}).then(f)}(R,F).then((function(e){w.textContent=e.name,j.textContent=e.about})).catch((function(e){c(K),Y(e.message,Q,V),console.log("Error: ".concat(e))})).finally((function(){a(D),setTimeout((function(){N.textContent="Сохранить"}),W)}))})),_.addEventListener("submit",(function(e){var t,r;e.preventDefault(),y.textContent="Сохранение...",(t=h,r=b,fetch("".concat(d.baseUrl,"cards"),{method:"POST",headers:d.headers,body:JSON.stringify({name:t.value,link:r.value})}).then(f)).then((function(e){L(v,x(e))})).catch((function(e){c(popupError),Y(e.message,errorTitle,errorText),console.log("Error: ".concat(e))})).finally((function(){a(S),setTimeout((function(){_.reset(),l(y,X.inactiveButtonClass),y.textContent="Создать"}),W)}))})),U.addEventListener("click",(function(){return c(I)})),H.addEventListener("submit",(function(e){var t;e.preventDefault(),M.textContent="Сохранение...",(t=z.value,fetch("".concat(d.baseUrl,"users/me/avatar"),{method:"PATCH",headers:d.headers,body:JSON.stringify({avatar:t})}).then(f)).then((function(e){A.src=e.avatar})).catch((function(e){c(K),Y(e.message,Q,V),console.log("Error: ".concat(e))})).finally((function(){a(I),setTimeout((function(){H.reset(),l(M,X.inactiveButtonClass),M.textContent="Сохранить"}),W)}))})),G.forEach((function(e){e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup_opened")&&(a(e),t.target.classList.contains("popup_for_delete-card")&&q.removeEventListener("click",m)),t.target.classList.contains("popup__close-button")&&(E.classList.contains("popup_opened")&&q.removeEventListener("click",m),a(e))}))})),Promise.all([fetch("".concat(d.baseUrl,"cards"),{headers:d.headers}).then(f),p()]).then((function(e){e[0].forEach((function(e){L(v,x(e),!0)})),w.textContent=e[1].name,j.textContent=e[1].about,A.src=e[1].avatar})).catch((function(e){c(K),Y(e.message,Q,V),console.log("Ошибка: ".concat(e))})),O=(k=X).formSelector,T=s(k,["formSelector"]),Array.from(document.querySelectorAll(O)).forEach((function(e){!function(e,t){var r=t.inputSelector,n=t.errorClass,o=t.inputErrorClass,c=s(t,u),a=Array.from(e.querySelectorAll(r));a.forEach((function(t){t.addEventListener("input",(function(){!function(e,t,r,n){var o=e.querySelector("#error-".concat(t.id));t.validity.valid?function(e,t,r,n){e.classList.remove(r),t.classList.remove(n),e.textContent=""}(o,t,r,n):function(e,t,r,n){e.classList.add(r),t.classList.add(n),e.textContent=t.validationMessage}(o,t,r,n)}(e,t,n,o),function(e,t,r){var n=r.submitButtonSelector,o=r.inactiveButtonClass,c=e.querySelector(n);!function(e){return e.some((function(e){return!e.validity.valid}))}(t)?function(e,t){e.classList.remove(t),e.removeAttribute("disabled")}(c,o):l(c,o)}(e,a,c)}))}))}(e,T)}))})();